<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Section 12: Difference of means</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Section 12: Difference of means
## <br/>STOR 155.02, Spring â€™21
### updated 2021-04-20

---

class: left, middle






## What you will learn

- is in the title

## Resources

- Textbook ch 6.2

---
class: inverse, left, middle

## **Eyes on the schedule**

### Three lectures remain

- 20, 27, May 4

### Final project due May 11, 3p.m. **sharp**

- **no excuses for lateness** 
- **except** by approved university exam excuses or exceptional circumstances
- assigned one week prior

---
class: left, top

## Question: 
### Do women who have taken hormonal birth control have a higher risk for breast cancer than those who haven't?

[Contemporary Hormonal Contraception and the Risk of Breast Cancer](https://www.nejm.org/doi/full/10.1056/NEJMoa1700732)

a large-scale study in Denmark from a few years ago


#### How to answer this question?

---
background-image: url(gudetama.png)
---
class: left, top

## Mathematical formulation

.pull-left[
### 'Treatment group'

#### hormonal birth control (BC) users
all biologically female

#### random sample size `\(n_1\)`
from a 'true' but unknown r.v. `\(X\)`

`$$X_i = 1\left\{\text{ith person got cancer}\right\}$$`

#### **true cancer probability for BC users**

`$$m_1 = E(X)$$`

]
.pull-right[
### 'Control' group

#### females who never have used BC

#### random sample of size `\(n_0\)`
from unknown r.v. `\(Y\)`

`$$Y_i = 1\left\{\text{ith person got cancer}\right\}$$`

#### **true cancer prob for non-BC group**

$$m_0 = E(Y) $$
]

---
class: left, top

### Do a hypothesis test!

`$$H_0: m_1 = m_0, \quad \quad H_1: m_1 &gt; m_0, \quad \text{or} \quad m_1 \neq m_0$$`

#### would allow us to say something like 

&gt;&gt; with xx% confidence we reject the null hypothesis that birth control users have the same chance of contracting cancer as non-users.

### Problem

#### previously, we needed to know the value `\(m_0\)`

#### here `\(m_0\)` also is not known!

---
class: left, top

### Recap: calculation for 'two-sided test' when **null-hypothesis value is known**

#### point estimates from data

`$$\hat{s}_n/ \sqrt{n} = \text{ point estimate for s.d. of } \bar{X}_n$$`

`$$\hat{m}_n = \text{ point estimate for mean of X}$$`

#### p-value
`$$p = 2 P\left(Z &lt; -\frac{|\hat{m}_n - m_0|}{\hat{s}_n / \sqrt{n}}\right) \approx P\left(\frac{|\bar{X}_{n} - m_0|}{\hat{s}_n / \sqrt{n}} &gt; \frac{|\hat{m}_n - m_0|}{\hat{s}_n / \sqrt{n}}\right)$$`

#### decision rule for level `\(\alpha\)` test

`$$\text{reject } H_0 \text{ if } \quad p \le \alpha$$`

#### example: `\(\alpha = 0.03\)`
`$$\text{reject } H_0 \text{ with 97% confidence if }  \quad p \le 0.03$$`

---
class: inverse, center, middle

# Difference of means tests

---
class: left, top

### Want to test

`$$H_0: m_1 = m_0, \quad \quad H_1:  m_1 \neq m_0$$`

### Reformulate

`$$H_0: m_1-m_0 = 0, \quad \quad H_1:  m_1-m_0 \neq 0$$`

#### now it's the same as we saw previously, with

`$$m = m_1-m_0$$`

### Ingredients

`$$\hat{m}_{n_1, n_0} = \text{ point estimate for the mean of the difference } \bar{X}_{n_1} - \bar{Y}_{n_0}$$`

`$$\hat{s}_{n_1, n_0} = \text{ point estimate for the s.d. of the difference } \bar{X}_{n_1} - \bar{Y}_{n_0}$$`

---
class: center, middle

### Review Q:

#### If `\(V_1, V_0\)` are **independent random variables** with s.d. `\(s_1, s_0\)`, what is 

`$$sd(V_1 + V_2) = \text{ ?}$$`

### Apply this to the difference of means test problem

`$$V_1 = \bar{X}_{n_1}, \quad \quad V_2 = - \bar{Y}_{n_0}$$`

`$$sd\left(\bar{X}_{n_1} - \bar{Y}_{n_0}\right) = \text{ ?}$$`

---
class: left, top

### Calculating p-values for difference of means

#### point estimates from data
`$$\hat{m}_{n_1, n_0} = \hat{m}_{n_1} - \hat{m}_{n_0} = \text{ difference of sample means, treatment vs. control}$$`

`$$\hat{s}_{n_1, n_0} = \sqrt{\frac{\hat{s}_{n_1}^2}{n_1} + \frac{\hat{s}_{n_0}^2}{n_0}}$$`

#### p-value for two-sided test
Same formula, different point estimates.

`$$p = 2 P\left(Z &lt; -\frac{|\hat{m}_{n_1} - \hat{m}_{n_0}|}{\hat{s}_{n_1, n_0}}\right) \approx P\left(\frac{|\bar{X}_{n_1} - \bar{Y}_{n_0}|}{\hat{s}_{n_1, n_0}} &gt; \frac{|\hat{m}_{n_1} - \hat{m}_{n_0}|}{\hat{s}_{n_1, n_0}}\right)$$`

#### could also do a confidence interval

`$$\text{high}, \text{low} = \left( \hat{m}_{n_1} - \hat{m}_{n_0}\right)  \pm z^* \hat{s}_{n_1, n_0}$$`

---
class: left, top

### When does it make sense to use this test?


.pull-left[
### recap: assumptions for one-sample test

#### CLT/LLN are valid

#### meaning random sample

#### from a common population

#### that is `big enough'
]
.pull-right[
### two-sample assumptions

#### one-sample assumptions apply to **both treatment and control groups**

#### treatment and control are **independent from each other**
]

---
class: left, top

### Example: Breast cancer study
From [breast cancer study in Denmark](https://www.nejm.org/doi/full/10.1056/NEJMoa1700732), table 2.

- **Treatment**: Any hormonal contraception in current/recent use
- **Control**: Never used hormonal contraception


|          | mhat| shat_mean|
|:---------|----:|---------:|
|control   |   55|      3.25|
|treatment |   68|      3.14|

---
class: left,top
### Notes on the data
I've simplified a few things to make it fit in our class's discussion, but **our conclusions (p-values) will match theirs.**

#### Sample sizes and cancer rates
I've hidden these because they are more confusing than helpful here. Sample sizes in the data really are numbers of 'person years.' 

The cancer incident rates shown above are cases of cancer per 100k --- **adjusted for age** in a way that is not relevant for the class. This is the number they use for the study's conclusions, so I use it here.

But if I were to put the number of person-years as well, we'd get a kind of funny-looking comparison between cancer rates and sample size.

Sample standard deviations are backed out of the data to give the same p-value as one of the main conclusions of the study.

---
class: left,top

### One-sided test
#### Analogous to one-sided version of one-sample test.

`$$H_1: m_1 - m_0 &gt; 0$$`

`$$p = P\left(Z &lt; -\frac{\hat{m}_{n_1} - \hat{m}_{n_0}}{\hat{s}_{n_1, n_0}}\right) = P\left(Z &lt; - \frac{68 - 55}{\sqrt{3.25^2 + 3.14^2}}\right)$$`


|         p|
|---------:|
| 0.0020093|


### Same p-value as the paper
See note about about how I simplified this for class.

### Q: How would you interpret this result? 
**Use language from class**

---
class: inverse, center, middle

# Aside: Is this bad news for me (you, all of us)?

---
class: left, top

### Absolute risk, relative risk and 'significance'

.pull-left[
#### **relative**

- are birth-control users more at risk for breast cancer **compared to non-BC users**?

- is this difference **statistically** significant, at some `\(\alpha\)` level?

#### That's why we do hypothesis tests.

#### A statistical question

]
.pull-right[
#### **absolute**

- is birth-control use a **substantial contributor to my overall risk** of injury/death?

- compared to **other sources, e.g. car accidents**?

#### even the people in the study who used birth control 10+ years had risk of *contracting* breast cancer that was ~15 smaller than the **risk of dying in a car accident in the US**

- Cancer rate for that group: ~ 1 per 100k 'life years'
- motor vehicle fatalities in the US: 12-15 per 100k people/year

]

---
class: center, middle

## PollEv.com/brendanbrown849

## poll closes at `_________`


---
class: center, top
background-image: url(gudetama2.png)
background-size: contain

???
image credit: deviantart.com/atsushika28
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "solarized-light",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
